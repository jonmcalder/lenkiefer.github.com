theme(plot.title=element_text(size=14))+
theme(axis.text=element_text(size=8))+
theme(plot.caption=element_text(hjust=0))
#animate strip
d.list<-unique(pmms30yr[year>2000]$date)
N<-length(d.list)
N
saveGIF({for (i in c(seq(1,N,200)) {
test<-pmms30yr[year>2000 & date<=d.list[i]]
g<-
ggplot(data=pmms30yr[year>2000,],aes(x=week,y=1,color=d52,fill=d52))+
geom_col(alpha=0,color=NA,fill=NA)+
geom_col(data=test)+
scale_fill_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
scale_color_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
theme_minimal()+
facet_wrap(~year,ncol=4)+
theme(axis.ticks.y=element_blank(),
axis.text.y=element_blank(),
panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
axis.text.x=element_text(size=6))+
labs(x="", y="",
title="30-year Fixed Mortgage Rate",
subtitle="52-week change in percentage points",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
scale_x_continuous(breaks=c(1,26,52),labels=c("Jan","Jul","Dec"))+
theme(plot.title=element_text(size=14))+
theme(axis.text=element_text(size=8))+
theme(plot.caption=element_text(hjust=0))
print(g)
print(paste(i,"out of",N))
ani.pause()
}
for (i2 in 1:3) {
print(g)
ani.pause()
}
#},movie.name="rate_7_29_2016.gif",ani.width = 500, ani.height = 350)
},movie.name="rate_strip_12_08_2016.gif",ani.width = 650, ani.height = 400)
saveGIF({for (i in c(seq(1,N,200))) {
test<-pmms30yr[year>2000 & date<=d.list[i]]
g<-
ggplot(data=pmms30yr[year>2000,],aes(x=week,y=1,color=d52,fill=d52))+
geom_col(alpha=0,color=NA,fill=NA)+
geom_col(data=test)+
scale_fill_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
scale_color_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
theme_minimal()+
facet_wrap(~year,ncol=4)+
theme(axis.ticks.y=element_blank(),
axis.text.y=element_blank(),
panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
axis.text.x=element_text(size=6))+
labs(x="", y="",
title="30-year Fixed Mortgage Rate",
subtitle="52-week change in percentage points",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
scale_x_continuous(breaks=c(1,26,52),labels=c("Jan","Jul","Dec"))+
theme(plot.title=element_text(size=14))+
theme(axis.text=element_text(size=8))+
theme(plot.caption=element_text(hjust=0))
print(g)
print(paste(i,"out of",N))
ani.pause()
}
for (i2 in 1:3) {
print(g)
ani.pause()
}
#},movie.name="rate_7_29_2016.gif",ani.width = 500, ani.height = 350)
},movie.name="rate_strip_12_08_2016.gif",ani.width = 650, ani.height = 400)
c(seq(1,N,12),N-3,N-2,N-1,N)
c(seq(1,N,12),N-2,N-1,N)
saveGIF({for (i in  c(seq(1,N,12),N-2,N-1,N)    ) {
test<-pmms30yr[year>2000 & date<=d.list[i]]
g<-
ggplot(data=pmms30yr[year>2000,],aes(x=week,y=1,color=d52,fill=d52))+
geom_col(alpha=0,color=NA,fill=NA)+
geom_col(data=test)+
scale_fill_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
scale_color_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
theme_minimal()+
facet_wrap(~year,ncol=4)+
theme(axis.ticks.y=element_blank(),
axis.text.y=element_blank(),
panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
axis.text.x=element_text(size=6))+
labs(x="", y="",
title="30-year Fixed Mortgage Rate",
subtitle="52-week change in percentage points",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
scale_x_continuous(breaks=c(1,26,52),labels=c("Jan","Jul","Dec"))+
theme(plot.title=element_text(size=14))+
theme(axis.text=element_text(size=8))+
theme(plot.caption=element_text(hjust=0))
print(g)
print(paste(i,"out of",N))
ani.pause()
}
for (i2 in 1:3) {
print(g)
ani.pause()
}
#},movie.name="rate_7_29_2016.gif",ani.width = 500, ani.height = 350)
},movie.name="rate_strip_12_08_2016.gif",ani.width = 650, ani.height = 400)
pmms30yr
pmms30yr[,id:=1:.N]
pmms30yr
i
test[,id:=1:.N]
test<-pmms30yr[year>2000,]
test[,id:=1:.N]
test
i
i<-400
ggplot(data=test,aes(x=week,y=1,color=d52,fill=d52,alpha=ifelse(id>i,1,i/id)))+
geom_col(data=test)+
scale_fill_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
scale_color_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
theme_minimal()+
facet_wrap(~year,ncol=4)+
theme(axis.ticks.y=element_blank(),
axis.text.y=element_blank(),
panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
axis.text.x=element_text(size=6))+
labs(x="", y="",
title="30-year Fixed Mortgage Rate",
subtitle="52-week change in percentage points",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
scale_x_continuous(breaks=c(1,26,52),labels=c("Jan","Jul","Dec"))+
theme(plot.title=element_text(size=14))+
theme(axis.text=element_text(size=8))+
theme(plot.caption=element_text(hjust=0))
ggplot(data=test,aes(x=week,y=1,fill=d52,alpha=ifelse(id>i,1,i/id)))+
geom_col(color=NA)+
guides(alpha=F)+
scale_fill_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
scale_color_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
theme_minimal()+
facet_wrap(~year,ncol=4)+
theme(axis.ticks.y=element_blank(),
axis.text.y=element_blank(),
panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
axis.text.x=element_text(size=6))+
labs(x="", y="",
title="30-year Fixed Mortgage Rate",
subtitle="52-week change in percentage points",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
scale_x_continuous(breaks=c(1,26,52),labels=c("Jan","Jul","Dec"))+
theme(plot.title=element_text(size=14))+
theme(axis.text=element_text(size=8))+
theme(plot.caption=element_text(hjust=0))
i
test
i
i
i<-20
ggplot(data=test,aes(x=week,y=1,fill=d52,alpha=ifelse(id>i,1,i/id)))+
geom_col(color=NA)+
guides(alpha=F)+
scale_fill_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
scale_color_viridis(name="52-week\nChange (pp)",discrete=F,option="B")+
theme_minimal()+
facet_wrap(~year,ncol=4)+
theme(axis.ticks.y=element_blank(),
axis.text.y=element_blank(),
panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
axis.text.x=element_text(size=6))+
labs(x="", y="",
title="30-year Fixed Mortgage Rate",
subtitle="52-week change in percentage points",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
scale_x_continuous(breaks=c(1,26,52),labels=c("Jan","Jul","Dec"))+
theme(plot.title=element_text(size=14))+
theme(axis.text=element_text(size=8))+
theme(plot.caption=element_text(hjust=0))
library(tweenr)
DT<-copy(pmms30yr)
myf<-function(dd,dmin=as.Date("2014-12-31"),subt="Nothing",keepdots="No"){
DT2<-copy(DT)
#set max to last value
DT2[date>dd,rate:=DT[date==dd]$rate]
DT2[date>dd,date:=dd]
#set min to first value
DT2[date<=dmin,rate:=DT[date==dmin]$rate]
DT2[date<=dmin,date:=dmin]
DT2[,subt:=label_wrap_gen(100)(subt)]
DT2$subt<-factor(DT2$subt)
DT2$keepdots<-factor(keepdots)
as.data.frame(DT2[, list(date,rate,subt,keepdots)])}
tf <- tween_states(
list(myf(as.Date("2016-11-03"),as.Date("2015-12-31"),subt="rates fell throughout most of 2016 up to the U.S. general election..."),
myf(as.Date("2016-12-01"),as.Date("2015-12-31"),subt="...rising rapidly after the election...."),
myf(as.Date("2016-12-01"),as.Date("2015-07-16"),subt="...rates are up to the highest level since July 2015...."),
myf(as.Date("2016-12-01"),as.Date("2012-12-27"),subt="...having declined after the Taper Talk in 2013...."),
myf(as.Date("2016-12-01"),as.Date("1971-04-02"),subt="...and after over 30 years of general decline."),
myf(as.Date("2015-12-31"),as.Date("2015-12-31"),subt="...rates entered 2016 above 4%, but...")
),tweenlength= 3, statelength=1, ease=rep('cubic-in-out',2),nframes=100)
tf<-data.table(tf)
tf
oopt = ani.options(interval = 0.15)
saveGIF({for (i in 1:44) {
g<-
ggplot(data=pmms30yr[date=='2015-12-31' | (date>='2015-12-31' & week<=i)], aes(x=date,y=rate,label=paste(" ",rate)))+
geom_line()+theme_minimal()+
theme(legend.position="none")+
geom_text(data=pmms30yr[date>='2015-12-31' & week==i],nudge_x=10)+
geom_point(data=pmms30yr[date>='2015-12-31' & week==i],size=2,color="red",alpha=0.75)+
labs(x="", y="Mortgage Rate (%)",
title="30-year Fixed Mortgage Rate (%)",
subtitle="Rates fell throughout most of 2016 up to the U.S. general election...",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
coord_cartesian(xlim=c(as.Date("2015-12-31"),as.Date("2016-12-31")), y=c(3.25,4.01))
print(g)
ani.pause()
print(i)
}
for (i in 1:1){
print(g)
ani.pause()
print(i)
}
for (i in 1:max(tf$.frame)) {
g<-
ggplot(data=tf[.frame==i], aes(x=date,y=rate,label=rate))+geom_line()+theme_minimal()+
theme(legend.position="none")+
geom_point(data=tf[date==max(tf[.frame==i]$date) & .frame==i,],size=2,color="red",alpha=0.75)+
labs(x="", y="Mortgage Rate (%)",
title="30-year Fixed Mortgage Rate (%)",
subtitle=tf[.frame==i,]$subt,
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
coord_cartesian(xlim=c(min(tf[.frame==i]$date),as.Date("2016-12-31")), y=c(3.25,max(tf[.frame==i]$rate)))
print(g)
ani.pause()
print(i)
}
},movie.name="rate_12_08_2016_annotate.gif",ani.width = 500, ani.height = 350)
unique(pmms30yr$date)
i<-44
ggplot(data=pmms30yr[date=='2015-12-31' | (date>='2015-12-31' & week<=i)], aes(x=date,y=rate,label=paste(" ",rate)))+
geom_line()+theme_minimal()+
theme(legend.position="none")+
geom_text(data=pmms30yr[date>='2015-12-31' & week==i],nudge_x=10)+
geom_point(data=pmms30yr[date>='2015-12-31' & week==i],size=2,color="red",alpha=0.75)+
labs(x="", y="Mortgage Rate (%)",
title="30-year Fixed Mortgage Rate (%)",
subtitle="Rates fell throughout most of 2016 up to the U.S. general election...",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
coord_cartesian(xlim=c(as.Date("2015-12-31"),as.Date("2016-12-31")), y=c(3.25,4.13))
ggplot(data=tf[.frame==i], aes(x=date,y=rate,label=rate))+geom_line()+theme_minimal()+
theme(legend.position="none")+
geom_point(data=tf[date==max(tf[.frame==i]$date) & .frame==i,],size=2,color="red",alpha=0.75)+
labs(x="", y="Mortgage Rate (%)",
title="30-year Fixed Mortgage Rate (%)",
subtitle=tf[.frame==i,]$subt,
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
coord_cartesian(xlim=c(min(tf[.frame==i]$date),as.Date("2016-12-31")), y=c(3.25,max(tf[.frame==i]$rate)))
i<-1
ggplot(data=tf[.frame==i], aes(x=date,y=rate,label=rate))+geom_line()+theme_minimal()+
theme(legend.position="none")+
geom_point(data=tf[date==max(tf[.frame==i]$date) & .frame==i,],size=2,color="red",alpha=0.75)+
labs(x="", y="Mortgage Rate (%)",
title="30-year Fixed Mortgage Rate (%)",
subtitle=tf[.frame==i,]$subt,
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
coord_cartesian(xlim=c(min(tf[.frame==i]$date),as.Date("2016-12-31")), y=c(3.25,max(tf[.frame==i]$rate)))
max(tf[.frame==i]$rate)
tf <- tween_states(
list(myf(as.Date("2016-11-03"),as.Date("2015-12-31"),subt="rates fell throughout most of 2016 up to the U.S. general election..."),
myf(as.Date("2016-12-08"),as.Date("2015-10-02"),subt="...rising rapidly after the election...."),
myf(as.Date("2016-12-08"),as.Date("2015-07-16"),subt="...rates are up to the highest level since Oct 2014...."),
myf(as.Date("2016-12-08"),as.Date("2012-12-27"),subt="...having declined after the Taper Talk in 2013...."),
myf(as.Date("2016-12-08"),as.Date("1971-04-02"),subt="...and after over 30 years of general decline."),
myf(as.Date("2015-12-31"),as.Date("2015-12-31"),subt="...rates entered 2016 above 4%, but...")
),tweenlength= 3, statelength=1, ease=rep('cubic-in-out',2),nframes=100)
tf<-data.table(tf)
oopt = ani.options(interval = 0.15)
saveGIF({for (i in 1:44) {
g<-
ggplot(data=pmms30yr[date=='2015-12-31' | (date>='2015-12-31' & week<=i)], aes(x=date,y=rate,label=paste(" ",rate)))+
geom_line()+theme_minimal()+
theme(legend.position="none")+
geom_text(data=pmms30yr[date>='2015-12-31' & week==i],nudge_x=10)+
geom_point(data=pmms30yr[date>='2015-12-31' & week==i],size=2,color="red",alpha=0.75)+
labs(x="", y="Mortgage Rate (%)",
title="30-year Fixed Mortgage Rate (%)",
subtitle="Rates fell throughout most of 2016 up to the U.S. general election...",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
coord_cartesian(xlim=c(as.Date("2015-12-31"),as.Date("2016-12-31")), y=c(3.25,4.01))
print(g)
ani.pause()
print(i)
}
for (i in 1:1){
print(g)
ani.pause()
print(i)
}
for (i in 1:max(tf$.frame)) {
g<-
ggplot(data=tf[.frame==i], aes(x=date,y=rate,label=rate))+geom_line()+theme_minimal()+
theme(legend.position="none")+
geom_point(data=tf[date==max(tf[.frame==i]$date) & .frame==i,],size=2,color="red",alpha=0.75)+
labs(x="", y="Mortgage Rate (%)",
title="30-year Fixed Mortgage Rate (%)",
subtitle=tf[.frame==i,]$subt,
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
coord_cartesian(xlim=c(min(tf[.frame==i]$date),as.Date("2016-12-31")), y=c(3.25,max(tf[.frame==i]$rate)))
print(g)
ani.pause()
print(i)
}
},movie.name="rate_12_08_2016_annotate.gif",ani.width = 500, ani.height = 350)
tf <- tween_states(
list(myf(as.Date("2016-11-03"),as.Date("2015-12-31"),subt="rates fell throughout most of 2016 up to the U.S. general election..."),
myf(as.Date("2016-12-08"),as.Date("2015-10-02"),subt="...rising rapidly after the election...."),
myf(as.Date("2016-12-08"),as.Date("2015-07-16"),subt="...rates are up to the highest level since Oct 2014...."),
myf(as.Date("2016-12-08"),as.Date("2012-12-27"),subt="...having declined after the Taper Talk in 2013...."),
myf(as.Date("2016-12-08"),as.Date("1971-04-02"),subt="...and after over 30 years of general decline."),
myf(as.Date("2015-12-31"),as.Date("2015-12-31"),subt="...rates entered 2016 above 4%, but...")
),tweenlength= 3, statelength=1, ease=rep('cubic-in-out',2),nframes=100)
tf <- tween_states(
list(myf(as.Date("2016-11-03"),as.Date("2015-12-31"),subt="rates fell throughout most of 2016 up to the U.S. general election..."),
myf(as.Date("2016-12-08"),as.Date("2014-10-02"),subt="...rising rapidly after the election...."),
myf(as.Date("2016-12-08"),as.Date("2015-07-16"),subt="...rates are up to the highest level since Oct 2014...."),
myf(as.Date("2016-12-08"),as.Date("2012-12-27"),subt="...having declined after the Taper Talk in 2013...."),
myf(as.Date("2016-12-08"),as.Date("1971-04-02"),subt="...and after over 30 years of general decline."),
myf(as.Date("2015-12-31"),as.Date("2015-12-31"),subt="...rates entered 2016 above 4%, but...")
),tweenlength= 3, statelength=1, ease=rep('cubic-in-out',2),nframes=100)
tf<-data.table(tf)
oopt = ani.options(interval = 0.15)
saveGIF({for (i in 1:44) {
g<-
ggplot(data=pmms30yr[date=='2015-12-31' | (date>='2015-12-31' & week<=i)], aes(x=date,y=rate,label=paste(" ",rate)))+
geom_line()+theme_minimal()+
theme(legend.position="none")+
geom_text(data=pmms30yr[date>='2015-12-31' & week==i],nudge_x=10)+
geom_point(data=pmms30yr[date>='2015-12-31' & week==i],size=2,color="red",alpha=0.75)+
labs(x="", y="Mortgage Rate (%)",
title="30-year Fixed Mortgage Rate (%)",
subtitle="Rates fell throughout most of 2016 up to the U.S. general election...",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
coord_cartesian(xlim=c(as.Date("2015-12-31"),as.Date("2016-12-31")), y=c(3.25,4.01))
print(g)
ani.pause()
print(i)
}
for (i in 1:1){
print(g)
ani.pause()
print(i)
}
for (i in 1:max(tf$.frame)) {
g<-
ggplot(data=tf[.frame==i], aes(x=date,y=rate,label=rate))+geom_line()+theme_minimal()+
theme(legend.position="none")+
geom_point(data=tf[date==max(tf[.frame==i]$date) & .frame==i,],size=2,color="red",alpha=0.75)+
labs(x="", y="Mortgage Rate (%)",
title="30-year Fixed Mortgage Rate (%)",
subtitle=tf[.frame==i,]$subt,
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
coord_cartesian(xlim=c(min(tf[.frame==i]$date),as.Date("2016-12-31")), y=c(3.25,max(tf[.frame==i]$rate)))
print(g)
ani.pause()
print(i)
}
},movie.name="rate_12_08_2016_annotate.gif",ani.width = 500, ani.height = 350)
tf <- tween_states(
list(myf(as.Date("2016-11-03"),as.Date("2015-12-31"),subt="rates fell throughout most of 2016 up to the U.S. general election..."),
myf(as.Date("2016-12-01"),as.Date("2015-12-31"),subt="...rising rapidly after the election...."),
myf(as.Date("2016-12-08"),as.Date("2015-10-02"),subt="...rates are up to the highest level since Oct 2014...."),
myf(as.Date("2016-12-08"),as.Date("2012-12-27"),subt="...having declined after the Taper Talk in 2013...."),
myf(as.Date("2016-12-08"),as.Date("1971-04-02"),subt="...and after over 30 years of general decline."),
myf(as.Date("2015-12-31"),as.Date("2015-12-31"),subt="...rates entered 2016 above 4%, but...")
),tweenlength= 3, statelength=1, ease=rep('cubic-in-out',2),nframes=100)
tf<-data.table(tf)
tf <- tween_states(
list(myf(as.Date("2016-11-03"),as.Date("2015-12-31"),subt="rates fell throughout most of 2016 up to the U.S. general election..."),
myf(as.Date("2016-12-01"),as.Date("2015-12-31"),subt="...rising rapidly after the election...."),
myf(as.Date("2016-12-08"),as.Date("2014-10-02"),subt="...rates are up to the highest level since Oct 2014...."),
myf(as.Date("2016-12-08"),as.Date("2012-12-27"),subt="...having declined after the Taper Talk in 2013...."),
myf(as.Date("2016-12-08"),as.Date("1971-04-02"),subt="...and after over 30 years of general decline."),
myf(as.Date("2015-12-31"),as.Date("2015-12-31"),subt="...rates entered 2016 above 4%, but...")
),tweenlength= 3, statelength=1, ease=rep('cubic-in-out',2),nframes=100)
tf<-data.table(tf)
oopt = ani.options(interval = 0.15)
saveGIF({for (i in 1:44) {
g<-
ggplot(data=pmms30yr[date=='2015-12-31' | (date>='2015-12-31' & week<=i)], aes(x=date,y=rate,label=paste(" ",rate)))+
geom_line()+theme_minimal()+
theme(legend.position="none")+
geom_text(data=pmms30yr[date>='2015-12-31' & week==i],nudge_x=10)+
geom_point(data=pmms30yr[date>='2015-12-31' & week==i],size=2,color="red",alpha=0.75)+
labs(x="", y="Mortgage Rate (%)",
title="30-year Fixed Mortgage Rate (%)",
subtitle="Rates fell throughout most of 2016 up to the U.S. general election...",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
coord_cartesian(xlim=c(as.Date("2015-12-31"),as.Date("2016-12-31")), y=c(3.25,4.01))
print(g)
ani.pause()
print(i)
}
for (i in 1:1){
print(g)
ani.pause()
print(i)
}
for (i in 1:max(tf$.frame)) {
g<-
ggplot(data=tf[.frame==i], aes(x=date,y=rate,label=rate))+geom_line()+theme_minimal()+
theme(legend.position="none")+
geom_point(data=tf[date==max(tf[.frame==i]$date) & .frame==i,],size=2,color="red",alpha=0.75)+
labs(x="", y="Mortgage Rate (%)",
title="30-year Fixed Mortgage Rate (%)",
subtitle=tf[.frame==i,]$subt,
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
coord_cartesian(xlim=c(min(tf[.frame==i]$date),as.Date("2016-12-31")), y=c(3.25,max(tf[.frame==i]$rate)))
print(g)
ani.pause()
print(i)
}
},movie.name="rate_12_08_2016_annotate.gif",ani.width = 500, ani.height = 350)
KnitPost <- function(site.path='/pathToYourBlog/', overwriteAll=F, overwriteOne=NULL) {
if(!'package:knitr' %in% search()) library('knitr')
## Blog-specific directories.  This will depend on how you organize your blog.
site.path <- site.path # directory of jekyll blog (including trailing slash)
rmd.path <- paste0(site.path, "_Rmd") # directory where your Rmd-files reside (relative to base)
fig.dir <- "img/Rfig/" # directory to save figures
posts.path <- paste0(site.path, "_posts/") # directory for converted markdown files
cache.path <- paste0(site.path, "_cache/") # necessary for plots
render_jekyll(highlight = "pygments")
opts_knit$set(base.url = '/', base.dir = site.path)
opts_chunk$set(fig.path=fig.dir, fig.width=8.5, fig.height=5.25, dev='svg', cache=F,
warning=F, message=F, cache.path=cache.path, tidy=F)
setwd(rmd.path) # setwd to base
# some logic to help us avoid overwriting already existing md files
files.rmd <- data.frame(rmd = list.files(path = rmd.path,
full.names = T,
pattern = "\\.Rmd$",
ignore.case = T,
recursive = F), stringsAsFactors=F)
files.rmd$corresponding.md.file <- paste0(posts.path, "/", basename(gsub(pattern = "\\.Rmd$", replacement = ".md", x = files.rmd$rmd)))
files.rmd$corresponding.md.exists <- file.exists(files.rmd$corresponding.md.file)
## determining which posts to overwrite from parameters overwriteOne & overwriteAll
files.rmd$md.overwriteAll <- overwriteAll
if(is.null(overwriteOne)==F) files.rmd$md.overwriteAll[grep(overwriteOne, files.rmd[,'rmd'], ignore.case=T)] <- T
files.rmd$md.render <- F
for (i in 1:dim(files.rmd)[1]) {
if (files.rmd$corresponding.md.exists[i] == F) {
files.rmd$md.render[i] <- T
}
if ((files.rmd$corresponding.md.exists[i] == T) && (files.rmd$md.overwriteAll[i] == T)) {
files.rmd$md.render[i] <- T
}
}
# For each Rmd file, render markdown (contingent on the flags set above)
for (i in 1:dim(files.rmd)[1]) {
if (files.rmd$md.render[i] == T) {
out.file <- knit(as.character(files.rmd$rmd[i]),
output = as.character(files.rmd$corresponding.md.file[i]),
envir = parent.frame(),
quiet = T)
message(paste0("KnitPost(): ", basename(files.rmd$rmd[i])))
}
}
}
library("knitr")
#KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=TRUE, overwriteOne=NULL)
#KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=FALSE, overwriteOne=4)
#brocks::htmlwidgets_deps(a)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
