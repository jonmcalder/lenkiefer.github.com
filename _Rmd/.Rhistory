mydata[,sales.max08:=max(ifelse(year<2008,sales,0),na.rm=T)]
#compute post-2008 trough
mydata[,sales.min08:=min(ifelse(year>2008,sales,1000),na.rm=T)]
# get dates of max/min
s.min<-mydata[sales==sales.min08][,date.min:=date][,c("date.min")]
s.max<-mydata[sales==sales.max08][,date.max:=date][,c("date.max")]
mydata$date.min<-s.min
mydata$data.max<-s.max
#c(min(dt2$date),dt2[,min(date),by=year(date)]$V1,max(dt2$date))
d.max<-dt2[nhs.sa==max(dt2$nhs.sa)]$date
d.min<-dt2[nhs.sa==min(dt2[year(date)>2008,]$nhs.sa)]$date
d.end<-max(dt2$date)
d.start<-min(dt2[year>1998]$date)
my.list2<-lapply(c(dt2[(year(date) %in% c(1959,1969,1979,1989,1999)|year(date)>1999),
max(date),by=year(date)]$V1,max(dt2$date)) ,myf)
library(tweenr)
library(animation)
my.list2<-lapply(c(max(dt2$date),min(dt2$date),s.max,s.min,max(dt2$date)),myf)
#use tweenr to interploate
seq.Date(as.Date("2014-01-01"),as.Date("2017-01-01"),by="1 month")
d.list<-
c(as.Date("2017-01-01"), min(mydata$date),as.Date("2002-12-01"),
s.max$date.max,seq.Date(s.min$date.min,as.Date("2016-02-01"),by="24 month"),
as.Date("2016-01-01"), as.Date("2017-01-01"), as.Date("2017-01-01"))
my.list2<-lapply(d.list,myf)
my.list2<-lapply(c(d.start,d.max,d.min,d.end,d.end,d.start),myf)
tf <- tween_states(my.list2,tweenlength= 3,
statelength=2, ease=rep('cubic-in-out',2),nframes=75)
tf<-data.table(tf) #convert output into data table
#Animate plot
oopt = ani.options(interval = 0.1)
saveGIF({for (i in 1:max(tf$.frame)) { #loop over frames
g<-
myp(tf[.frame==i],xlim=xlim,ylim=ylim,
in.name="Rise, fall, and recovery of new home sales")
print(g)
ani.pause()
print(paste(i,"out of",max(tf$.frame)))}
for (i in 1:10){
print(g)
ani.pause()
}
},movie.name="tween test new sales 05 25 2017.gif",ani.width = 500, ani.height = 400)
library(data.table)
library(reshape2)
library(stringr)
library(ggplot2)
library(scales)
library(ggthemes)
library(rgeos)
library(maptools)
library(albersusa)
library(dplyr)
library(tidyr)
library(ggalt)
library(viridis)
library(zoo)
#read in data available as a text file from the FHFA website:
fhfa.data<-fread("http://www.fhfa.gov/DataTools/Downloads/Documents/HPI/HPI_PO_state.txt")
#create annual house price growth in the SA index:
fhfa.data[,hpa12:=index_sa/shift(index_sa,4)-1,by=state]
fhfa.data[,iso_3166_2:=state]  #rename state to match usa_composite
fhfa.data[,date:=as.Date(ISOdate(yr,qtr*3,1))] #make a date (don't need it here)
fhfa.data[,mylabel:=paste0("Q",qtr,":",yr)]  #create date label for plot
#do map stuff
states<-usa_composite()
smap<-fortify(states,region="fips_state")
states@data <- left_join(states@data, fhfa.data, by = "iso_3166_2")
#make plots:
ggplot() +
geom_map(data = smap, map = smap,
aes(x = long, y = lat, map_id = id),
color = "#2b2b2b", size = 0.05, fill = NA) +
geom_map(data =subset(states@data,yr>2005 & qtr==1), map = smap,
aes( map_id = fips_state,fill=hpa12),
color = "gray", size = .25) +
theme_map( base_size = 12) +facet_wrap(~mylabel,ncol=3)+
theme(plot.title=element_text( size = 16, margin=margin(b=10))) +
theme(plot.subtitle=element_text(size = 14, margin=margin(b=-20))) +
theme(plot.caption=element_text(size = 9, margin=margin(t=-15))) +
coord_proj(us_laea_proj) +   labs(title="",subtitle="" ) +
scale_fill_viridis(name = "", discrete=F,option="D",end=0.95,
direction=-1,limits=c(-0.35,0.35),label=percent)+
theme(legend.position = "top") +theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
labs(title=paste0("Annual House Price Growth (Y/Y %)"),
caption="@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)")
KnitPost <- function(site.path='/pathToYourBlog/', overwriteAll=F, overwriteOne=NULL) {
if(!'package:knitr' %in% search()) library('knitr')
## Blog-specific directories.  This will depend on how you organize your blog.
site.path <- site.path # directory of jekyll blog (including trailing slash)
rmd.path <- paste0(site.path, "_Rmd") # directory where your Rmd-files reside (relative to base)
fig.dir <- "img/Rfig/" # directory to save figures
posts.path <- paste0(site.path, "_posts/") # directory for converted markdown files
cache.path <- paste0(site.path, "_cache/") # necessary for plots
render_jekyll(highlight = "pygments")
opts_knit$set(base.url = '/', base.dir = site.path)
opts_chunk$set(fig.path=fig.dir, fig.width=8.5, fig.height=5.25, dev='svg', cache=F,
warning=F, message=F, cache.path=cache.path, tidy=F)
setwd(rmd.path) # setwd to base
# some logic to help us avoid overwriting already existing md files
files.rmd <- data.frame(rmd = list.files(path = rmd.path,
full.names = T,
pattern = "\\.Rmd$",
ignore.case = T,
recursive = F), stringsAsFactors=F)
files.rmd$corresponding.md.file <- paste0(posts.path, "/", basename(gsub(pattern = "\\.Rmd$", replacement = ".md", x = files.rmd$rmd)))
files.rmd$corresponding.md.exists <- file.exists(files.rmd$corresponding.md.file)
## determining which posts to overwrite from parameters overwriteOne & overwriteAll
files.rmd$md.overwriteAll <- overwriteAll
if(is.null(overwriteOne)==F) files.rmd$md.overwriteAll[grep(overwriteOne, files.rmd[,'rmd'], ignore.case=T)] <- T
files.rmd$md.render <- F
for (i in 1:dim(files.rmd)[1]) {
if (files.rmd$corresponding.md.exists[i] == F) {
files.rmd$md.render[i] <- T
}
if ((files.rmd$corresponding.md.exists[i] == T) && (files.rmd$md.overwriteAll[i] == T)) {
files.rmd$md.render[i] <- T
}
}
# For each Rmd file, render markdown (contingent on the flags set above)
for (i in 1:dim(files.rmd)[1]) {
if (files.rmd$md.render[i] == T) {
out.file <- knit(as.character(files.rmd$rmd[i]),
output = as.character(files.rmd$corresponding.md.file[i]),
envir = parent.frame(),
quiet = T)
message(paste0("KnitPost(): ", basename(files.rmd$rmd[i])))
}
}
}
library("knitr")
#KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=TRUE, overwriteOne=NULL)
#KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=FALSE, overwriteOne=4)
#brocks::htmlwidgets_deps(a)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
ggplot(data=mygraph.data,aes(x=date,y=hpa12,group=state))+theme_minimal()+
geom_line()+
scale_color_viridis(name = "Annual House Price Growth (Y/Y %)", discrete=F,option="D",end=0.95)+
scale_y_continuous(label=percent, breaks=c(-.2,-.1,0,.1,.2))+
theme(axis.text.y=element_text(size=6))+
theme(axis.text.x=element_text(size=6))+
geom_area(fill=viridis(5)[3],alpha=0.5)+
scale_x_date()+
geom_point(data=subset(mygraph.data,date==max(mygraph.data$date)),
aes(color=hpa12),alpha=0.75,size=2)+
theme(legend.position = "none")+
facet_wrap(~forcats::fct_reorder(state,-hpa12,last),ncol=10)+
theme(plot.caption=element_text(hjust=0))+
labs(x="",y="",title="Annual House Price Growth (Y/Y %)",
caption="@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)")
ggplot(data=mydata, aes(x=date,y=sales, label = slabel))+
geom_line(data=mydata[1:i,])+
scale_y_continuous(limits = c(200, 1600), breaks=seq(200,1600,200)) +
geom_point(data=mydata[i,],colour = plasma(5)[1], size = 3)+
scale_x_date(labels= date_format("%b-%Y"), limits = as.Date(c('2000-01-01','2016-12-31'))) +
geom_ribbon(data=mydata[1:i,],aes(x=date,ymin=down,ymax=up),fill=plasma(5)[5],alpha=0.5)  +
geom_hline(yintercept=mydata$sales[i],linetype=2,color=plasma(5)[1])+
theme(axis.title.x = element_blank()) +   # Remove x-axis label
ylab("")+xlab("")+
theme_minimal()+
labs(x=NULL, y=NULL,
title="New Home Sales (Ths. SAAR)",
subtitle=paste(as.character(mydata$date[i],format="%b-%Y"),":",mydata$slabel[i]),
caption="@lenkiefer Source: Census/HUD, shaded area denotes confidence interval")+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.subtitle=element_text(color=plasma(5)[1]))+
theme(plot.margin=unit(c(0.5,0.5,0.5,0.75),"cm"))
mydata<-read_excel("data/ehs mar 2017.xlsx",sheet="sales")
mydata$date<-as.Date(mydata$date, format="%m/%d/%Y")
mydata$sales<-mydata$nhs.sa
ggplot(data=mydata, aes(x=date,y=sales, label = slabel))+
geom_line(data=mydata)+
scale_y_continuous(limits = c(200, 1600), breaks=seq(200,1600,200)) +
geom_point(data=tail(mydata,1),colour = plasma(5)[1], size = 3)+
scale_x_date(labels= date_format("%b-%Y"), limits = as.Date(c('2000-01-01','2017-12-31'))) +
geom_ribbon(data=mydata[1:i,],aes(x=date,ymin=down,ymax=up),fill=plasma(5)[5],alpha=0.5)  +
geom_hline(yintercept=mydata$sales[i],linetype=2,color=plasma(5)[1])+
theme(axis.title.x = element_blank()) +   # Remove x-axis label
ylab("")+xlab("")+
theme_minimal()+
labs(x=NULL, y=NULL,
title="New Home Sales (Ths. SAAR)",
subtitle=paste(as.character(mydata$date[i],format="%b-%Y"),":",mydata$slabel[i]),
caption="@lenkiefer Source: Census/HUD, shaded area denotes confidence interval")+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.subtitle=element_text(color=plasma(5)[1]))+
theme(plot.margin=unit(c(0.5,0.5,0.5,0.75),"cm"))
mydata<-read_excel("data/ehs mar 2017.xlsx",sheet="sales")
mydata$date<-as.Date(mydata$date, format="%m/%d/%Y")
ggplot(data=mydata, aes(x=date,y=nhs.sa, label = nhs.sa))+
geom_line(data=mydata)+
geom_point(data=tail(mydata,1),colour = plasma(5)[1], size = 3)+
scale_x_date(labels= date_format("%b-%Y"),
limits = as.Date(c('2000-01-01','2017-12-31'))) +
geom_ribbon(data=mydata,
aes(x=date,ymin=down,ymax=up),fill=plasma(5)[5],alpha=0.5)  +
geom_hline(yintercept=tail(mydata,1)$nhs.sa,linetype=2,color=plasma(5)[1])+
theme(axis.title.x = element_blank()) +   # Remove x-axis label
ylab("")+xlab("")+
theme_minimal()+
labs(x=NULL, y=NULL,
title="New Home Sales (Ths. SAAR)",
caption="@lenkiefer Source: Census/HUD, shaded area denotes confidence interval")+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.subtitle=element_text(color=plasma(5)[1]))+
theme(plot.margin=unit(c(0.5,0.5,0.5,0.75),"cm"))
KnitPost <- function(site.path='/pathToYourBlog/', overwriteAll=F, overwriteOne=NULL) {
if(!'package:knitr' %in% search()) library('knitr')
## Blog-specific directories.  This will depend on how you organize your blog.
site.path <- site.path # directory of jekyll blog (including trailing slash)
rmd.path <- paste0(site.path, "_Rmd") # directory where your Rmd-files reside (relative to base)
fig.dir <- "img/Rfig/" # directory to save figures
posts.path <- paste0(site.path, "_posts/") # directory for converted markdown files
cache.path <- paste0(site.path, "_cache/") # necessary for plots
render_jekyll(highlight = "pygments")
opts_knit$set(base.url = '/', base.dir = site.path)
opts_chunk$set(fig.path=fig.dir, fig.width=8.5, fig.height=5.25, dev='svg', cache=F,
warning=F, message=F, cache.path=cache.path, tidy=F)
setwd(rmd.path) # setwd to base
# some logic to help us avoid overwriting already existing md files
files.rmd <- data.frame(rmd = list.files(path = rmd.path,
full.names = T,
pattern = "\\.Rmd$",
ignore.case = T,
recursive = F), stringsAsFactors=F)
files.rmd$corresponding.md.file <- paste0(posts.path, "/", basename(gsub(pattern = "\\.Rmd$", replacement = ".md", x = files.rmd$rmd)))
files.rmd$corresponding.md.exists <- file.exists(files.rmd$corresponding.md.file)
## determining which posts to overwrite from parameters overwriteOne & overwriteAll
files.rmd$md.overwriteAll <- overwriteAll
if(is.null(overwriteOne)==F) files.rmd$md.overwriteAll[grep(overwriteOne, files.rmd[,'rmd'], ignore.case=T)] <- T
files.rmd$md.render <- F
for (i in 1:dim(files.rmd)[1]) {
if (files.rmd$corresponding.md.exists[i] == F) {
files.rmd$md.render[i] <- T
}
if ((files.rmd$corresponding.md.exists[i] == T) && (files.rmd$md.overwriteAll[i] == T)) {
files.rmd$md.render[i] <- T
}
}
# For each Rmd file, render markdown (contingent on the flags set above)
for (i in 1:dim(files.rmd)[1]) {
if (files.rmd$md.render[i] == T) {
out.file <- knit(as.character(files.rmd$rmd[i]),
output = as.character(files.rmd$corresponding.md.file[i]),
envir = parent.frame(),
quiet = T)
message(paste0("KnitPost(): ", basename(files.rmd$rmd[i])))
}
}
}
library("knitr")
#KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=TRUE, overwriteOne=NULL)
#KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=FALSE, overwriteOne=4)
#brocks::htmlwidgets_deps(a)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
library(geofacet)
mygraph.data<-filter(fhfa.data,yr>2004 & state !="DCA")
xlim<-c(min(mygraph.data$date),max(mygraph.data$date))
# create plot:
ggplot(mygraph.data, aes(x=date, y=hpa12,fill=hpa12)) +
# geom col for little bars
geom_col()+
# use facet_geo
facet_geo(~ state, grid = "us_state_grid2")+
# my go to theme
theme_minimal()+
# the colors!
scale_fill_viridis(option="C",limits=c(-0.35,0.35),
label=percent,name="12-month\n% change")+
# set up x (date) and y (HPA) axes
scale_x_date(limits=xlim,breaks=xlim,date_labels="%y")+
scale_y_continuous(label=percent,limits=c(-0.35,0.35),
breaks=seq(-0.3,.3,.3))+
# labels, title, caption
labs(x="",y="",
title="House Price Appreciation",
subtitle="12-month percent change in March",
caption="@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)")+
# adjust theme
theme(plot.caption=element_text(hjust=0),
# need to shrink axis text
axis.text.x=element_text(size=7),
plot.subtitle=element_text(face="italic"),
legend.position="top")
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
require("animation")
library("ggplot2")
library("scales")
require('ggthemes')
source("C:/Users/Leonard/Documents/Data Viz/blog/myggplot2.R")
library(data.table)
library("viridis")
library(ggbeeswarm)
library(tidyverse)
library(readxl)
setwd('C:/Users/Leonard/Documents/Data Viz/blog/pmms')
pmms30yr <- fread("~/Data Viz/blog/pmms/pmms30yr3.txt")
pmms30yr$date<-as.Date(pmms30yr$date, format="%m/%d/%Y")
dt<- read_excel('rates.xlsx',sheet= 'rates')
dt$date<-as.Date(dt$date, format="%m/%d/%Y")
pmms30yr<-dt
pmms30yr$rate<-pmms30yr$rate30
pmms30yr<-data.table(pmms30yr)
i0<-nrow(pmms30yr)
pmms30yr$x=pmms30yr$date
pmms30yr$y=pmms30yr$rate
pmms30yr$slabel=pmms30yr$rate
#choose starting point
istart<-576
istart<-nrow(pmms30yr[date<'2015-12-31'])+1
i<-nrow(pmms30yr)
pd<-pmms30yr[date>='2015-12-31']
#get max week numbers in 2016
N<-max(pmms30yr[year==2016,]$week)
dlist<-unique(pmms30yr[year(date)>2015,]$date)
dlist<-unique(pmms30yr[date>="2016-03-10",]$date)
#blue based on: https://issuu.com/universityofkentucky/docs/graphic_standards_a16-7
N<-length(dlist)
oopt = ani.options(interval = 0.15)
saveGIF({for (i in 1:N) {
g<-
ggplot(data=pmms30yr[date>="2016-03-10" & date<=dlist[i]],
aes(x=date,y=rate,label=rate))+
geom_line(size=1.05,color="#0033a0")+theme_minimal()+
theme(legend.position="none")+
scale_x_date(date_breaks="1 month", date_labels="%b-%Y")+
scale_y_continuous(limits=c(3,4.4),breaks=seq(3,4.4,.1),sec.axis=dup_axis())+
geom_text(data=tail(pmms30yr[date==dlist[i]],1),
nudge_x=3,nudge_y=0,hjust=-0.1,size=3,color="#0033a0")+
geom_point(data=tail(pmms30yr[date==dlist[i]],1),size=3,color="#0033a0",alpha=0.75)+
labs(x="", y="",
title="30-year Fixed Mortgage Rate (%)",
subtitle="weekly average rates",
caption="@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey")+
theme(plot.title=element_text(size=18,color="#0033a0"))+
theme(plot.caption=element_text(hjust=0,vjust=1,margin=margin(t=10)))+
theme(plot.margin=unit(c(0.25,0.25,0.25,0.25),"cm"))+
#plot.background=element_rect(fill="royalblue"))+
coord_cartesian(xlim=c(as.Date("2016-04-07"),as.Date("2017-06-15")), y=c(3.4,4.4))
print(g)
print(paste(i,"out of",N))
ani.pause()
}
for (i2 in 1:8) {
print(g)
ani.pause()
}
#},movie.name="rate_7_29_2016.gif",ani.width = 500, ani.height = 350)
},movie.name="rate_05_25_2017 v3.gif",ani.width = 700, ani.height = 450)
library(geofacet)
mygraph.data<-filter(fhfa.data,yr>2012 )
xlim<-c(min(mygraph.data$date),max(mygraph.data$date))
# create plot:
ggplot(mygraph.data, aes(x=date, y=hpa12)) +
geom_line()+
facet_geo(~ state, grid = "us_state_grid2")+
theme_minimal()+
scale_fill_viridis(option="C",limits=c(-0.35,0.35),
label=percent,name="12-month\n% change")+
scale_x_date(limits=xlim,breaks=xlim,date_labels="%y")+
scale_y_continuous(label=percent,limits=c(-0.35,0.35),
breaks=seq(-0.3,.3,.3))+
labs(x="",y="",
title="House Price Appreciation",
subtitle="12-month percent change since 2013",
caption="@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)")+
# adjust theme
theme(plot.caption=element_text(hjust=0),
# need to shrink axis text
axis.text.x=element_text(size=7),
plot.subtitle=element_text(face="italic"),
legend.position="top")
summary(mygraph.data)
# create plot:
ggplot(mygraph.data, aes(x=date, y=hpa12)) +
geom_line()+
facet_geo(~ state, grid = "us_state_grid2")+
theme_minimal()+
scale_fill_viridis(option="C",limits=c(-0.05,0.35),
label=percent,name="12-month\n% change")+
scale_x_date(limits=xlim,breaks=xlim,date_labels="%y")+
scale_y_continuous(label=percent,limits=c(-0.05,0.3),
breaks=seq(-0.0,.3,.15))+
labs(x="",y="",
title="House Price Appreciation",
subtitle="12-month percent change since 2013",
caption="@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)")+
# adjust theme
theme(plot.caption=element_text(hjust=0),
# need to shrink axis text
axis.text.x=element_text(size=7),
plot.subtitle=element_text(face="italic"),
legend.position="top")
summary(mygraph.data)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
mygraph.data<-subset(states@data,(yr>1990 & state !="DC"))
summary(mygraph.data)
mygraph.data<-filter(fhfa.data,yr>1990 )
xlim<-c(min(mygraph.data$date),max(mygraph.data$date))
# create plot:
ggplot(mygraph.data, aes(x=date, y=hpa12)) +
geom_line()+
facet_geo(~ state, grid = "us_state_grid2")+
theme_minimal()+
scale_fill_viridis(option="C",limits=c(-0.35,0.35),
label=percent,name="12-month\n% change")+
scale_x_date(limits=xlim,breaks=xlim,date_labels="%y")+
scale_y_continuous(label=percent,limits=c(-0.35,0.35),
breaks=seq(-0.3,.3,.3))+
labs(x="",y="",
title="House Price Appreciation",
subtitle="12-month percent change since  1991",
caption="@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)")+
# adjust theme
theme(plot.caption=element_text(hjust=0),
# need to shrink axis text
axis.text.x=element_text(size=7),
plot.subtitle=element_text(face="italic"),
legend.position="top")
ggplot(data=mygraph.data,aes(x=date,y=hpa12,group=state))+theme_minimal()+
geom_line()+
scale_color_viridis(name = "Annual House Price Growth (Y/Y %)", discrete=F,option="D",end=0.95)+
scale_y_continuous(label=percent, breaks=c(-.2,-.1,0,.1,.2))+
theme(axis.text.y=element_text(size=6))+
theme(axis.text.x=element_text(size=6))+
geom_area(fill=viridis(5)[3],alpha=0.5)+
scale_x_date()+
geom_hline(yintercept=0,color="gray",linetype=2)+
geom_point(data=subset(mygraph.data,date==max(mygraph.data$date)),
aes(color=hpa12),alpha=0.75,size=2)+
theme(legend.position = "none")+
facet_wrap(~forcats::fct_reorder(state,-hpa12,last),ncol=10)+
theme(plot.caption=element_text(hjust=0))+
labs(x="",y="",title="Annual House Price Growth (Y/Y %)",
caption="@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)")
ggplot(data=mygraph.data,aes(x=date,y=hpa12,group=state))+theme_minimal()+
geom_line()+
scale_color_viridis(name = "Annual House Price Growth (Y/Y %)", discrete=F,option="D",end=0.95)+
scale_y_continuous(label=percent, breaks=c(-.2,-.1,0,.1,.2))+
theme(axis.text.y=element_text(size=6))+
theme(axis.text.x=element_text(size=6))+
geom_area(fill=viridis(5)[3],alpha=0.5)+
scale_x_date()+
geom_hline(yintercept=0,color="gray",linetype=2)+
geom_point(data=subset(mygraph.data,date==max(mygraph.data$date)),
aes(color=hpa12),alpha=0.75,size=2)+
theme(legend.position = "none")+
facet_wrap(~forcats::fct_reorder(state,-hpa12,last),ncol=10)+
theme(plot.caption=element_text(hjust=0))+
labs(x="",y="",title="Annual House Price Growth (Y/Y %)",
caption="@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)")
mygraph.data<-subset(states@data,(yr>2004 & state !="DC"))
ggplot(data=mygraph.data,aes(x=date,y=hpa12,group=state))+theme_minimal()+
geom_line()+
scale_color_viridis(name = "Annual House Price Growth (Y/Y %)", discrete=F,option="D",end=0.95)+
scale_y_continuous(label=percent, breaks=c(-.2,-.1,0,.1,.2))+
theme(axis.text.y=element_text(size=6))+
theme(axis.text.x=element_text(size=6))+
geom_area(fill=viridis(5)[3],alpha=0.5)+
scale_x_date()+
geom_hline(yintercept=0,color="gray",linetype=2)+
geom_point(data=subset(mygraph.data,date==max(mygraph.data$date)),
aes(color=hpa12),alpha=0.75,size=2)+
theme(legend.position = "none")+
facet_wrap(~forcats::fct_reorder(state,-hpa12,last),ncol=10)+
theme(plot.caption=element_text(hjust=0))+
labs(x="",y="",title="Annual House Price Growth (Y/Y %)",
caption="@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)")
ggplot(data=mygraph.data,aes(x=date,y=hpa12,group=state))+theme_minimal()+
geom_line()+
scale_color_viridis(name = "Annual House Price Growth (Y/Y %)", discrete=F,option="D",end=0.95)+
scale_y_continuous(label=percent, breaks=c(-.2,-.1,0,.1,.2))+
theme(axis.text.y=element_text(size=6))+
theme(axis.text.x=element_text(size=6))+
geom_area(fill=viridis(5)[3],alpha=0.5)+
scale_x_date()+
#geom_hline(yintercept=0,color="gray",linetype=2)+
geom_point(data=subset(mygraph.data,date==max(mygraph.data$date)),
aes(color=hpa12),alpha=0.75,size=2)+
theme(legend.position = "none")+
facet_wrap(~forcats::fct_reorder(state,-hpa12,last),ncol=10)+
theme(plot.caption=element_text(hjust=0))+
labs(x="",y="",title="Annual House Price Growth (Y/Y %)",
caption="@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)")
ggplot(mygraph.data, aes(x=date, y=hpa12)) +
geom_line()+
geom_line(color="gray",linetype=2,aes(y=0))+
facet_geo(~ state, grid = "us_state_grid2")+
theme_minimal()+
scale_fill_viridis(option="C",limits=c(-0.35,0.35),
label=percent,name="12-month\n% change")+
scale_x_date(limits=xlim,breaks=xlim,date_labels="%y")+
scale_y_continuous(label=percent,limits=c(-0.35,0.35),
breaks=seq(-0.3,.3,.3))+
labs(x="",y="",
title="House Price Appreciation",
subtitle="12-month percent change since  1991",
caption="@lenkiefer Source: FHFA Purchase-Only House Price Index (SA)")+
# adjust theme
theme(plot.caption=element_text(hjust=0),
# need to shrink axis text
axis.text.x=element_text(size=7),
plot.subtitle=element_text(face="italic"),
legend.position="top")
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
KnitPost(site.path="C:/Users/Leonard/Documents/webpage/live/lenkiefer.github.com/", overwriteAll=T, overwriteOne=NULL)
